{"ast":null,"code":"import{IonContent,IonList,IonPage}from\"@ionic/react\";import React,{useEffect,useRef,useState}from\"react\";import{useHistory}from\"react-router-dom\";import Header from\"../../components/Header\";import Icon from\"../../components/Icon\";import TxtInput from\"../../components/txtinput/TxtInput\";import Store from\"../../redux/Store\";import{getProfileData,updateProfile}from\"../../services/EndPointApi\";import{isEmpty}from\"../../util/Utilities\";import\"./Profile.scss\";import _ from\"lodash\";import Alert from\"../../components/alert/Alert\";var objectdefn={firstName:{}};function Profile(){var _userDetails$user$act;var userDetails=Store.getState().CheckUserStatus;const[userInfo,setUser]=useState({userName:userDetails.user.userName,agentCode:(_userDetails$user$act=userDetails.user.activeCompanyCode)===null||_userDetails$user$act===void 0?void 0:_userDetails$user$act.split(\"-\")[1]});const[alertPopup,showAlertPopup]=useState(false);const[toGoPathName,settoGoPathName]=useState(\"\");let history=useHistory();const[form,setForm]=useState({firstName:\"\",lastName:\"\",email:\"\",mobileNumber:\"\",landlineNumber:\"\",submitted:false,valid:false,agentCode:\"\",userName:\"\"});const profileImageIconProps={name:\"profile-pic-icon\",slot:\"icon-only\",class:\"zoom84\"};const pencilIconProps={name:\"pencil\",styleProps:{stroke:\"#FF5959\",styleProps:{zoom:0.7}}};const[errors,setErrors]=useState({});const[initialFormData,setinitialFormData]=useState({});useEffect(()=>{fetchDetails();},[]);const unblockHandle=useRef();useEffect(()=>{if(history){unblockHandle.current=history.block((_ref,action)=>{let{pathname}=_ref;settoGoPathName(pathname);if(pathname!==\"/tabs/profile\"){let finalData=form;delete finalData.agentCode;delete finalData.valid;delete finalData.submitted;if(!_.isEqual(initialFormData,finalData)){showAlertPopup(true);return false;}}});return function(){unblockHandle.current.current&&unblockHandle.current.current();};}},[initialFormData,form]);const fetchDetails=async()=>{let resp=await getProfileData(userInfo.userName);if(resp===null||resp===void 0?void 0:resp.success){await setForm({...form,...resp.data.data.dataItems[0]});setinitialFormData(resp.data.data.dataItems[0]);}};var updateFlag=false;const profileUpdate=async()=>{let errs={};if(isEmpty(form.firstName)){errs.firstName=\"First Name is required\";}if(isEmpty(form.lastName)){errs.lastName=\"Last Name is required\";}if(isEmpty(form.email)){errs.email=\"Email is required\";}if(isEmpty(form.mobileNumber)){errs.mobileNumber=\"Mobile Number is required\";}if(isEmpty(form.landlineNumber)){errs.landlineNumber=\"Landline Number is required\";}if(errors.email!==\"\"||errors.mobileNumber!==\"\"||errors.landlineNumber!==\"\"){}else if(!Object.values(errors).some(x=>x!==null&&x!==\"\")){let updateProfileResp=await updateProfile(form);if(updateProfileResp.success){updateFlag=true;}else{updateFlag=false;}}const isEmpt=!Object.values(errors).some(x=>x!==null&&x!==\"\");setErrors({...errors,...errs});return updateFlag;};const handleChange=(e,value)=>{errors[e.target.name]=\"\";setForm({...form,[e.target.name]:value});};const alertProps={isShow:alertPopup,message:\"\",alertAction:alertAction,content:\" You have made some changes. Do you want to save the changes before leaving?\",okButtonName:\"Save\",cancelButtonName:\"Cancel\",icon:\"<img src='/assets/icon/are-you-sure.svg'/>\",itemName:\"\"};async function alertAction(item,actionType){showAlertPopup(false);if(actionType){var upadtedOrNot=await profileUpdate();if(upadtedOrNot){fetchDetails();if(unblockHandle){unblockHandle.current();}history.push(toGoPathName+\"\");}}else{setForm(initialFormData);if(unblockHandle){unblockHandle.current();}history.push(toGoPathName+\"\");}}return/*#__PURE__*/React.createElement(IonPage,{id:\"profilePage\"},/*#__PURE__*/React.createElement(Header,{label:\"My Profile\",action:\"check\",checkClick:()=>profileUpdate()}),/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(Alert,{alertProps:alertProps}),/*#__PURE__*/React.createElement(\"div\",{className:\"main-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"login-logo\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"profile-icon\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Icon,{iconProps:profileImageIconProps})),/*#__PURE__*/React.createElement(\"div\",{className:\"pencil-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"border-pencil\"},/*#__PURE__*/React.createElement(Icon,{iconProps:pencilIconProps})))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"login-box-header\"}),/*#__PURE__*/React.createElement(\"form\",{noValidate:true,onSubmit:profileUpdate,autoComplete:\"off\"},/*#__PURE__*/React.createElement(IonList,{className:\"form-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"login-header\"},form.userName),/*#__PURE__*/React.createElement(\"div\",{className:\"list-margin\"},/*#__PURE__*/React.createElement(TxtInput,{name:\"agentCode\",value:userInfo.agentCode,label:\"Agent code\",errors:errors.agentCode,type:\"text\",required:true,readonly:true,onChange:handleChange,datatype:\"TEXT\",placeholder:\"Agent code\"}),/*#__PURE__*/React.createElement(TxtInput,{name:\"firstName\",value:form.firstName,label:\"First Name\",errors:errors.firstName,type:\"text\",required:true,onChange:handleChange,datatype:\"TEXT\",placeholder:\"First Name\"}),/*#__PURE__*/React.createElement(TxtInput,{name:\"lastName\",value:form.lastName,label:\"Last Name\",errors:errors.lastName,type:\"text\",required:true,onChange:handleChange,placeholder:\"Last Name\"}),/*#__PURE__*/React.createElement(TxtInput,{name:\"email\",value:form.email,label:\"Email\",errors:errors.email,type:\"email\",required:true,onChange:handleChange//description=\"Please enter email\"\n,placeholder:\"Email\",setError:erro=>setErrors({...errors,email:erro})}),/*#__PURE__*/React.createElement(TxtInput,{name:\"mobileNumber\",value:form.mobileNumber,label:\"Mobile\",errors:errors.mobileNumber,type:\"tel\",required:true,onChange:handleChange,datatype:\"TEL_NUM\"//pattern=\"###-##-#######\"\n,description:\"Tel Format 971 123456789\",placeholder:\"Mobile\",max:9,setError:erro=>setErrors({...errors,mobileNumber:erro})}),/*#__PURE__*/React.createElement(TxtInput,{name:\"landlineNumber\",value:form.landlineNumber,label:\"Phone\",errors:errors.landlineNumber,type:\"tel\",required:true,onChange:handleChange,datatype:\"TEL_NUM\"//pattern=\"###-##-######\"\n,description:\"Tel Format 971 12345678\",placeholder:\"Phone\",max:8,setError:erro=>setErrors({...errors,landlineNumber:erro})}))))))));}export default Profile;","map":{"version":3,"sources":["D:/DT/ptmsCheckOutNew/New-MobileApp/src/pages/profile/Profile.tsx"],"names":["IonContent","IonList","IonPage","React","useEffect","useRef","useState","useHistory","Header","Icon","TxtInput","Store","getProfileData","updateProfile","isEmpty","_","Alert","objectdefn","firstName","Profile","userDetails","getState","CheckUserStatus","userInfo","setUser","userName","user","agentCode","activeCompanyCode","split","alertPopup","showAlertPopup","toGoPathName","settoGoPathName","history","form","setForm","lastName","email","mobileNumber","landlineNumber","submitted","valid","profileImageIconProps","name","slot","class","pencilIconProps","styleProps","stroke","zoom","errors","setErrors","initialFormData","setinitialFormData","fetchDetails","unblockHandle","current","block","action","pathname","finalData","isEqual","resp","success","data","dataItems","updateFlag","profileUpdate","errs","Object","values","some","x","updateProfileResp","isEmpt","handleChange","e","value","target","alertProps","isShow","message","alertAction","content","okButtonName","cancelButtonName","icon","itemName","item","actionType","upadtedOrNot","push","erro"],"mappings":"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","sourcesContent":["import { IonContent, IonIcon, IonList, IonPage } from \"@ionic/react\";\r\nimport { arrowForwardOutline } from \"ionicons/icons\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { Prompt, useHistory } from \"react-router-dom\";\r\nimport Header from \"../../components/Header\";\r\nimport Icon from \"../../components/Icon\";\r\nimport TxtInput from \"../../components/txtinput/TxtInput\";\r\nimport Store from \"../../redux/Store\";\r\nimport { getProfileData, updateProfile } from \"../../services/EndPointApi\";\r\nimport * as EndPointURL from \"../../util/EndPointURL\";\r\nimport { isEmpty } from \"../../util/Utilities\";\r\nimport \"./Profile.scss\";\r\nimport _ from \"lodash\";\r\nimport Alert from \"../../components/alert/Alert\";\r\n\r\nvar objectdefn = {\r\n  firstName: {},\r\n};\r\nfunction Profile() {\r\n  var userDetails = Store.getState().CheckUserStatus;\r\n  const [userInfo, setUser] = useState<any>({\r\n    userName: userDetails.user.userName,\r\n    agentCode: userDetails.user.activeCompanyCode?.split(\"-\")[1],\r\n  });\r\n  const [alertPopup, showAlertPopup] = useState(false);\r\n  const [toGoPathName, settoGoPathName] = useState(\"\");\r\n  let history = useHistory();\r\n  const [form, setForm] = useState({\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    email: \"\",\r\n    mobileNumber: \"\",\r\n    landlineNumber: \"\",\r\n    submitted: false,\r\n    valid: false,\r\n    agentCode: \"\",\r\n    userName: \"\",\r\n  });\r\n\r\n  const profileImageIconProps = {\r\n    name: \"profile-pic-icon\",\r\n    slot: \"icon-only\",\r\n    class: \"zoom84\",\r\n  };\r\n\r\n  const pencilIconProps = {\r\n    name: \"pencil\",\r\n    styleProps: {\r\n      stroke: \"#FF5959\",\r\n      styleProps: { zoom: 0.7 },\r\n    },\r\n  };\r\n  const [errors, setErrors] = useState<any>({});\r\n  const [initialFormData, setinitialFormData] = useState<any>({});\r\n\r\n  useEffect(() => {\r\n    fetchDetails();\r\n  }, []);\r\n\r\n  const unblockHandle = useRef<any>();\r\n  useEffect(() => {\r\n    if (history) {\r\n      unblockHandle.current = history.block(({ pathname }, action) => {\r\n        settoGoPathName(pathname);\r\n        if (pathname !== \"/tabs/profile\") {\r\n          let finalData = form;\r\n          delete finalData.agentCode;\r\n          delete finalData.valid;\r\n          delete finalData.submitted;\r\n          if (!_.isEqual(initialFormData, finalData)) {\r\n            showAlertPopup(true);\r\n            return false;\r\n          }\r\n        }\r\n      });\r\n      return function () {\r\n        unblockHandle.current.current && unblockHandle.current.current();\r\n      };\r\n    }\r\n  }, [initialFormData, form]);\r\n\r\n  const fetchDetails = async () => {\r\n    let resp: any = await getProfileData(userInfo.userName);\r\n    if (resp?.success) {\r\n      await setForm({\r\n        ...form,\r\n        ...resp.data.data.dataItems[0],\r\n      });\r\n      setinitialFormData(resp.data.data.dataItems[0]);\r\n    }\r\n  };\r\n  var updateFlag = false;\r\n  const profileUpdate = async () => {\r\n    let errs: any = {};\r\n    if (isEmpty(form.firstName)) {\r\n      errs.firstName = \"First Name is required\";\r\n    }\r\n    if (isEmpty(form.lastName)) {\r\n      errs.lastName = \"Last Name is required\";\r\n    }\r\n\r\n    if (isEmpty(form.email)) {\r\n      errs.email = \"Email is required\";\r\n    }\r\n    if (isEmpty(form.mobileNumber)) {\r\n      errs.mobileNumber = \"Mobile Number is required\";\r\n    }\r\n    if (isEmpty(form.landlineNumber)) {\r\n      errs.landlineNumber = \"Landline Number is required\";\r\n    }\r\n    if (\r\n      errors.email !== \"\" ||\r\n      errors.mobileNumber !== \"\" ||\r\n      errors.landlineNumber !== \"\"\r\n    ) {\r\n    } else if (!Object.values(errors).some((x) => x !== null && x !== \"\")) {\r\n      let updateProfileResp = await updateProfile(form);\r\n      if (updateProfileResp.success) {\r\n        updateFlag = true;\r\n      } else {\r\n        updateFlag = false;\r\n      }\r\n    }\r\n    const isEmpt = !Object.values(errors).some((x) => x !== null && x !== \"\");\r\n\r\n    setErrors({ ...errors, ...errs });\r\n    return updateFlag;\r\n  };\r\n\r\n  const handleChange = (e: any, value: any) => {\r\n    errors[e.target.name] = \"\";\r\n    setForm({\r\n      ...form,\r\n      [e.target.name]: value,\r\n    });\r\n  };\r\n\r\n  const alertProps = {\r\n    isShow: alertPopup,\r\n    message: \"\",\r\n    alertAction: alertAction,\r\n    content:\r\n      \" You have made some changes. Do you want to save the changes before leaving?\",\r\n    okButtonName: \"Save\",\r\n    cancelButtonName: \"Cancel\",\r\n    icon: \"<img src='/assets/icon/are-you-sure.svg'/>\",\r\n    itemName: \"\",\r\n  };\r\n\r\n  async function alertAction(item, actionType) {\r\n    showAlertPopup(false);\r\n    if (actionType) {\r\n      var upadtedOrNot = await profileUpdate();\r\n      if (upadtedOrNot) {\r\n        fetchDetails();\r\n        if (unblockHandle) {\r\n          unblockHandle.current();\r\n        }\r\n        history.push(toGoPathName + \"\");\r\n      }\r\n    } else {\r\n      setForm(initialFormData);\r\n      if (unblockHandle) {\r\n        unblockHandle.current();\r\n      }\r\n      history.push(toGoPathName + \"\");\r\n    }\r\n  }\r\n  return (\r\n    <IonPage id=\"profilePage\">\r\n      <Header\r\n        label=\"My Profile\"\r\n        action=\"check\"\r\n        checkClick={() => profileUpdate()}\r\n      />\r\n      <IonContent>\r\n        <Alert alertProps={alertProps} />\r\n        <div className=\"main-container\">\r\n          <div className=\"login-logo\"></div>\r\n          <div className=\"profile-icon\">\r\n            <div>\r\n              <Icon iconProps={profileImageIconProps} />\r\n            </div>\r\n            <div className=\"pencil-container\">\r\n              <div className=\"border-pencil\">\r\n                <Icon iconProps={pencilIconProps} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"form-content\">\r\n            <div className=\"login-box-header\"></div>\r\n\r\n            <form noValidate onSubmit={profileUpdate} autoComplete=\"off\">\r\n              <IonList className=\"form-section\">\r\n                <div className=\"login-header\">\r\n                  {form.userName}\r\n                  {/* <hr /> */}\r\n                </div>\r\n\r\n                <div className=\"list-margin\">\r\n                  <TxtInput\r\n                    name={\"agentCode\"}\r\n                    value={userInfo.agentCode}\r\n                    label=\"Agent code\"\r\n                    errors={errors.agentCode}\r\n                    type=\"text\"\r\n                    required={true}\r\n                    readonly={true}\r\n                    onChange={handleChange}\r\n                    datatype=\"TEXT\"\r\n                    placeholder=\"Agent code\"\r\n                  />\r\n                  <TxtInput\r\n                    name={\"firstName\"}\r\n                    value={form.firstName}\r\n                    label=\"First Name\"\r\n                    errors={errors.firstName}\r\n                    type=\"text\"\r\n                    required={true}\r\n                    onChange={handleChange}\r\n                    datatype=\"TEXT\"\r\n                    placeholder=\"First Name\"\r\n                  />\r\n\r\n                  <TxtInput\r\n                    name={\"lastName\"}\r\n                    value={form.lastName}\r\n                    label=\"Last Name\"\r\n                    errors={errors.lastName}\r\n                    type=\"text\"\r\n                    required={true}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Last Name\"\r\n                  />\r\n\r\n                  <TxtInput\r\n                    name={\"email\"}\r\n                    value={form.email}\r\n                    label=\"Email\"\r\n                    errors={errors.email}\r\n                    type=\"email\"\r\n                    required={true}\r\n                    onChange={handleChange}\r\n                    //description=\"Please enter email\"\r\n                    placeholder=\"Email\"\r\n                    setError={(erro) => setErrors({ ...errors, email: erro })}\r\n                  />\r\n\r\n                  <TxtInput\r\n                    name={\"mobileNumber\"}\r\n                    value={form.mobileNumber}\r\n                    label=\"Mobile\"\r\n                    errors={errors.mobileNumber}\r\n                    type=\"tel\"\r\n                    required={true}\r\n                    onChange={handleChange}\r\n                    datatype=\"TEL_NUM\"\r\n                    //pattern=\"###-##-#######\"\r\n                    description=\"Tel Format 971 123456789\"\r\n                    placeholder=\"Mobile\"\r\n                    max={9}\r\n                    setError={(erro) =>\r\n                      setErrors({ ...errors, mobileNumber: erro })\r\n                    }\r\n                  />\r\n\r\n                  <TxtInput\r\n                    name={\"landlineNumber\"}\r\n                    value={form.landlineNumber}\r\n                    label=\"Phone\"\r\n                    errors={errors.landlineNumber}\r\n                    type=\"tel\"\r\n                    required={true}\r\n                    onChange={handleChange}\r\n                    datatype=\"TEL_NUM\"\r\n                    //pattern=\"###-##-######\"\r\n                    description=\"Tel Format 971 12345678\"\r\n                    placeholder=\"Phone\"\r\n                    max={8}\r\n                    setError={(erro) =>\r\n                      setErrors({ ...errors, landlineNumber: erro })\r\n                    }\r\n                  />\r\n                </div>\r\n              </IonList>\r\n              {/* <div className=\"button-div\">\r\n                <div className=\"button-holder\" onClick={profileUpdate}>\r\n                  <IonIcon slot=\"icon-only\" icon={arrowForwardOutline} />\r\n                </div>\r\n              </div> */}\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n}\r\n\r\nexport default Profile;\r\n"]},"metadata":{},"sourceType":"module"}